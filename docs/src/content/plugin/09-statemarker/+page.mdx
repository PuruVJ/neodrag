---
title: 'stateMarker'
tagline: 'Add data attributes to track drag state'
---

import FrameworkSwitch from '$components/FrameworkSwitch.astro';

The `stateMarker` plugin adds data attributes that track drag state. These attributes enable CSS styling based on drag status and provide hooks for debugging and analytics.

```typescript
stateMarker(); // Adds data-neodrag-state and data-neodrag-count attributes
```

**Attributes added:**

- `data-neodrag=""` - Marks element as draggable
- `data-neodrag-state="idle|dragging"` - Current drag state
- `data-neodrag-count="0"` - Number of completed drags

> **Note:** StateMarker is included by default and is non-cancelable, so it always runs regardless of other plugin cancellations.

## Basic Usage

<FrameworkSwitch>
<div slot="svelte">

```svelte
<script>
  import { stateMarker } from '@neodrag/svelte';
</script>

<div {@attach draggable([stateMarker()])}>
  Drag me - watch the data attributes change
</div>

<style>
  [data-neodrag-state='idle'] {
    background: #e3f2fd;
    border: 2px solid #2196f3;
  }

  [data-neodrag-state='dragging'] {
    background: #fff3e0;
    border: 2px solid #ff9800;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transform: scale(1.05);
  }
</style>
```

</div>

<div slot="react">

```tsx
import { useRef } from 'react';
import { stateMarker, useDraggable } from '@neodrag/react';

function StateMarkerExample() {
  const elementRef = useRef<HTMLDivElement>(null);

  useDraggable(elementRef, [stateMarker()]);

  return (
    <div>
      <div ref={elementRef} className="draggable">
        Drag me - watch the data attributes change
      </div>

      <style jsx>{`
        .draggable[data-neodrag-state='idle'] {
          background: #e3f2fd;
          border: 2px solid #2196f3;
        }

        .draggable[data-neodrag-state='dragging'] {
          background: #fff3e0;
          border: 2px solid #ff9800;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          transform: scale(1.05);
        }
      `}</style>
    </div>
  );
}
```

</div>

<div slot="vue">

```vue
<script setup>
import { stateMarker, vDraggable } from '@neodrag/vue';
</script>

<template>
  <div v-draggable="[stateMarker()]" class="draggable">
    Drag me - watch the data attributes change
  </div>
</template>

<style scoped>
.draggable[data-neodrag-state='idle'] {
  background: #e3f2fd;
  border: 2px solid #2196f3;
}

.draggable[data-neodrag-state='dragging'] {
  background: #fff3e0;
  border: 2px solid #ff9800;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  transform: scale(1.05);
}
</style>
```

</div>

<div slot="solid">

```tsx
import { createSignal } from 'solid-js';
import { stateMarker, createDraggable } from '@neodrag/solid';

function StateMarkerExample() {
  const { as: draggableDiv } = createDraggable(() => [stateMarker()]);

  return (
    <div>
      <draggableDiv class="draggable">
        Drag me - watch the data attributes change
      </draggableDiv>

      <style jsx>{`
        .draggable[data-neodrag-state='idle'] {
          background: #e3f2fd;
          border: 2px solid #2196f3;
        }

        .draggable[data-neodrag-state='dragging'] {
          background: #fff3e0;
          border: 2px solid #ff9800;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          transform: scale(1.05);
        }
      `}</style>
    </div>
  );
}
```

</div>

<div slot="vanilla">

```typescript
import { draggable, stateMarker } from '@neodrag/vanilla';

const element = document.getElementById('draggable');

draggable(element, [stateMarker()]);

// Add styles via stylesheet
const style = document.createElement('style');
style.textContent = `
  [data-neodrag-state='idle'] {
    background: #e3f2fd;
    border: 2px solid #2196f3;
  }

  [data-neodrag-state='dragging'] {
    background: #fff3e0;
    border: 2px solid #ff9800;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transform: scale(1.05);
  }
`;
document.head.appendChild(style);
```

</div>
</FrameworkSwitch>

## CSS Styling Examples

### State-Based Styling

```css
/* Idle state - ready to drag */
[data-neodrag-state='idle'] {
  cursor: grab;
  opacity: 0.8;
  transition: all 0.2s ease;
}

/* Dragging state - actively being dragged */
[data-neodrag-state='dragging'] {
  cursor: grabbing;
  opacity: 1;
  z-index: 1000;
  transition: none;
}

/* Count-based styling */
[data-neodrag-count='0'] {
  filter: grayscale(100%);
}

[data-neodrag-count]:not([data-neodrag-count='0']) {
  filter: none;
}
```

### Advanced Visual Effects

```css
/* Glow effect during drag */
[data-neodrag-state='dragging'] {
  box-shadow:
    0 0 20px rgba(33, 150, 243, 0.6),
    0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Progress indicator */
[data-neodrag]::after {
  content: 'Drags: ' attr(data-neodrag-count);
  position: absolute;
  top: -25px;
  right: 0;
  font-size: 12px;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 2px 6px;
  border-radius: 3px;
}
```

## JavaScript Integration

<FrameworkSwitch>
<div slot="svelte">

```svelte
<script>
  import { stateMarker, events } from '@neodrag/svelte';

  let dragCount = $state(0);
  let isDragging = $state(false);

  function handleStateChange(data) {
    const element = data.rootNode;
    dragCount = parseInt(element.dataset.neodragCount || '0');
    isDragging = element.dataset.neodragState === 'dragging';

    // Trigger achievements
    if (dragCount === 1) {
      showTooltip('First drag! üéâ');
    } else if (dragCount === 5) {
      showTooltip('Getting the hang of it! ‚≠ê');
    } else if (dragCount >= 10) {
      showTooltip("You're a drag expert! üëë");
    }
  }
</script>

<div
  {@attach draggable([
    stateMarker(),
    events({
      onDrag: handleStateChange,
      onDragEnd: handleStateChange,
    }),
  ])}
>
  Drag me (Count: {dragCount}, Active: {isDragging})
</div>
```

</div>

<div slot="react">

```tsx
import { useState, useRef } from 'react';
import { stateMarker, events, useDraggable } from '@neodrag/react';

function TrackingExample() {
  const elementRef = useRef<HTMLDivElement>(null);
  const [dragCount, setDragCount] = useState(0);
  const [isDragging, setIsDragging] = useState(false);

  const handleStateChange = (data) => {
    const element = data.rootNode;
    const count = parseInt(element.dataset.neodragCount || '0');
    const dragging = element.dataset.neodragState === 'dragging';

    setDragCount(count);
    setIsDragging(dragging);

    // Achievement system
    if (count === 1) {
      showTooltip('First drag! üéâ');
    } else if (count === 5) {
      showTooltip('Getting the hang of it! ‚≠ê');
    }
  };

  useDraggable(elementRef, [
    stateMarker(),
    events({
      onDrag: handleStateChange,
      onDragEnd: handleStateChange,
    }),
  ]);

  return (
    <div ref={elementRef}>
      Drag me (Count: {dragCount}, Active: {isDragging ? 'Yes' : 'No'}
      )
    </div>
  );
}
```

</div>

<div slot="vue">

```vue
<script setup>
import { ref } from 'vue';
import { stateMarker, events, vDraggable } from '@neodrag/vue';

const dragCount = ref(0);
const isDragging = ref(false);

function handleStateChange(data) {
  const element = data.rootNode;
  dragCount.value = parseInt(element.dataset.neodragCount || '0');
  isDragging.value = element.dataset.neodragState === 'dragging';

  // Achievement notifications
  if (dragCount.value === 1) {
    showTooltip('First drag! üéâ');
  } else if (dragCount.value === 5) {
    showTooltip('Getting the hang of it! ‚≠ê');
  }
}
</script>

<template>
  <div
    v-draggable="[
      stateMarker(),
      events({
        onDrag: handleStateChange,
        onDragEnd: handleStateChange,
      }),
    ]"
  >
    Drag me (Count: {{ dragCount }}, Active:
    {{ isDragging ? 'Yes' : 'No' }})
  </div>
</template>
```

</div>

<div slot="solid">

```tsx
import { createSignal } from 'solid-js';
import { stateMarker, events, createDraggable } from '@neodrag/solid';

function TrackingExample() {
  const [dragCount, setDragCount] = createSignal(0);
  const [isDragging, setIsDragging] = createSignal(false);

  const handleStateChange = (data) => {
    const element = data.rootNode;
    const count = parseInt(element.dataset.neodragCount || '0');
    const dragging = element.dataset.neodragState === 'dragging';

    setDragCount(count);
    setIsDragging(dragging);

    if (count === 1) {
      showTooltip('First drag! üéâ');
    }
  };

  const { as: draggableDiv } = createDraggable(() => [
    stateMarker(),
    events({
      onDrag: handleStateChange,
      onDragEnd: handleStateChange,
    }),
  ]);

  return (
    <draggableDiv>
      Drag me (Count: {dragCount()}, Active:{' '}
      {isDragging() ? 'Yes' : 'No'})
    </draggableDiv>
  );
}
```

</div>

<div slot="vanilla">

```typescript
import { draggable, stateMarker, events } from '@neodrag/vanilla';

const element = document.getElementById('draggable');
let dragCount = 0;
let isDragging = false;

function handleStateChange(data) {
  const element = data.rootNode;
  dragCount = parseInt(element.dataset.neodragCount || '0');
  isDragging = element.dataset.neodragState === 'dragging';

  // Update display
  element.textContent = `Drag me (Count: ${dragCount}, Active: ${isDragging ? 'Yes' : 'No'})`;

  // Achievement system
  if (dragCount === 1) {
    showTooltip('First drag! üéâ');
  } else if (dragCount === 5) {
    showTooltip('Getting the hang of it! ‚≠ê');
  }
}

draggable(element, [
  stateMarker(),
  events({
    onDrag: handleStateChange,
    onDragEnd: handleStateChange,
  }),
]);
```

</div>
</FrameworkSwitch>

## Common Use Cases

### Progress Indicators

```css
/* Show progress milestones */
[data-neodrag-count='1']::before {
  content: '‚≠ê Beginner';
}
[data-neodrag-count='5']::before {
  content: 'üî• Getting good';
}
[data-neodrag-count='10']::before {
  content: 'üèÜ Expert';
}
[data-neodrag-count='25']::before {
  content: 'üëë Master';
}

[data-neodrag]::before {
  position: absolute;
  top: -20px;
  left: 0;
  font-size: 10px;
  background: #333;
  color: white;
  padding: 2px 6px;
  border-radius: 3px;
}
```

### Debug Mode

```css
/* Visual debug overlay */
[data-neodrag] {
  outline: 2px dashed transparent;
  position: relative;
}

[data-neodrag]::after {
  content: attr(data-neodrag-state) ' (' attr(data-neodrag-count) ')';
  position: absolute;
  top: -20px;
  right: 0;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 2px 6px;
  font-size: 10px;
  border-radius: 3px;
  pointer-events: none;
}

[data-neodrag-state='idle'] {
  outline-color: #4caf50;
}
[data-neodrag-state='dragging'] {
  outline-color: #ff9800;
}
```

### Accessibility Enhancements

```css
/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  [data-neodrag-state='dragging'] {
    animation: none;
    transform: none;
  }
}

/* High contrast mode */
@media (prefers-contrast: high) {
  [data-neodrag-state='dragging'] {
    outline: 3px solid currentColor;
    outline-offset: 2px;
  }
}
```

## How It Works

The stateMarker plugin manages data attributes through the drag lifecycle:

1. **Setup phase:**

   - Adds `data-neodrag=""` to mark element
   - Sets `data-neodrag-state="idle"`
   - Initializes `data-neodrag-count="0"`

2. **Start phase:**

   - Updates `data-neodrag-state="dragging"`

3. **End phase:**

   - Resets `data-neodrag-state="idle"`
   - Increments `data-neodrag-count`

4. **Non-cancelable:**
   - Always runs regardless of other plugin cancellations
   - Ensures consistent state tracking

```typescript
// Simplified internal implementation
setup(ctx) {
  set_node_dataset(ctx.rootNode, 'neodrag', '');
  set_node_dataset(ctx.rootNode, 'neodrag-state', 'idle');
  set_node_dataset(ctx.rootNode, 'neodrag-count', '0');
},

start(ctx) {
  set_node_dataset(ctx.rootNode, 'neodrag-state', 'dragging');
},

end(ctx, state) {
  set_node_dataset(ctx.rootNode, 'neodrag-state', 'idle');
  set_node_dataset(ctx.rootNode, 'neodrag-count', ++state.count);
}
```

## API Reference

```typescript
function stateMarker(): Plugin;
```

**Parameters:** None

**Data attributes added:**

- `data-neodrag=""` - Marks element as draggable
- `data-neodrag-state="idle|dragging"` - Current drag state
- `data-neodrag-count="0"` - Number of completed drags

**Behavior:**

- Non-cancelable - always runs
- Updates attributes automatically during drag lifecycle
- Increments count only on successful drag completion
- Provides hooks for CSS styling and JavaScript integration

**Returns:** A plugin object for use with draggable.
